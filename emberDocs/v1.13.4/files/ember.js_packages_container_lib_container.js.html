<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>ember.js/packages/container/lib/container.js - The Ember API</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="The Ember API" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/Backburner.html">Backburner</a></li>
                                <li><a href="../classes/Container.html">Container</a></li>
                                <li><a href="../classes/Descriptor.html">Descriptor</a></li>
                                <li><a href="../classes/EachProxy.html">EachProxy</a></li>
                                <li><a href="../classes/Ember.html">Ember</a></li>
                                <li><a href="../classes/Ember._Metamorph.html">Ember._Metamorph</a></li>
                                <li><a href="../classes/Ember._MetamorphView.html">Ember._MetamorphView</a></li>
                                <li><a href="../classes/Ember.ActionHandler.html">Ember.ActionHandler</a></li>
                                <li><a href="../classes/Ember.Application.html">Ember.Application</a></li>
                                <li><a href="../classes/Ember.AriaRoleSupport.html">Ember.AriaRoleSupport</a></li>
                                <li><a href="../classes/Ember.Array.html">Ember.Array</a></li>
                                <li><a href="../classes/Ember.ArrayController.html">Ember.ArrayController</a></li>
                                <li><a href="../classes/Ember.ArrayProxy.html">Ember.ArrayProxy</a></li>
                                <li><a href="../classes/Ember.AutoLocation.html">Ember.AutoLocation</a></li>
                                <li><a href="../classes/Ember.Binding.html">Ember.Binding</a></li>
                                <li><a href="../classes/Ember.Checkbox.html">Ember.Checkbox</a></li>
                                <li><a href="../classes/Ember.ClassNamesSupport.html">Ember.ClassNamesSupport</a></li>
                                <li><a href="../classes/Ember.CollectionView.html">Ember.CollectionView</a></li>
                                <li><a href="../classes/Ember.Comparable.html">Ember.Comparable</a></li>
                                <li><a href="../classes/Ember.Component.html">Ember.Component</a></li>
                                <li><a href="../classes/Ember.computed.html">Ember.computed</a></li>
                                <li><a href="../classes/Ember.ComputedProperty.html">Ember.ComputedProperty</a></li>
                                <li><a href="../classes/Ember.ContainerDebugAdapter.html">Ember.ContainerDebugAdapter</a></li>
                                <li><a href="../classes/Ember.ContainerView.html">Ember.ContainerView</a></li>
                                <li><a href="../classes/Ember.Controller.html">Ember.Controller</a></li>
                                <li><a href="../classes/Ember.ControllerMixin.html">Ember.ControllerMixin</a></li>
                                <li><a href="../classes/Ember.Copyable.html">Ember.Copyable</a></li>
                                <li><a href="../classes/Ember.CoreObject.html">Ember.CoreObject</a></li>
                                <li><a href="../classes/Ember.CoreView.html">Ember.CoreView</a></li>
                                <li><a href="../classes/Ember.DataAdapter.html">Ember.DataAdapter</a></li>
                                <li><a href="../classes/Ember.DefaultResolver.html">Ember.DefaultResolver</a></li>
                                <li><a href="../classes/Ember.Deferred.html">Ember.Deferred</a></li>
                                <li><a href="../classes/Ember.EmptyViewSupport.html">Ember.EmptyViewSupport</a></li>
                                <li><a href="../classes/Ember.Enumerable.html">Ember.Enumerable</a></li>
                                <li><a href="../classes/Ember.EnumerableUtils.html">Ember.EnumerableUtils</a></li>
                                <li><a href="../classes/Ember.Error.html">Ember.Error</a></li>
                                <li><a href="../classes/Ember.EventDispatcher.html">Ember.EventDispatcher</a></li>
                                <li><a href="../classes/Ember.Evented.html">Ember.Evented</a></li>
                                <li><a href="../classes/Ember.FEATURES.html">Ember.FEATURES</a></li>
                                <li><a href="../classes/Ember.Freezable.html">Ember.Freezable</a></li>
                                <li><a href="../classes/Ember.Handlebars.html">Ember.Handlebars</a></li>
                                <li><a href="../classes/Ember.Handlebars.helpers.html">Ember.Handlebars.helpers</a></li>
                                <li><a href="../classes/Ember.HashLocation.html">Ember.HashLocation</a></li>
                                <li><a href="../classes/Ember.Helper.html">Ember.Helper</a></li>
                                <li><a href="../classes/Ember.HistoryLocation.html">Ember.HistoryLocation</a></li>
                                <li><a href="../classes/Ember.HTMLBars.html">Ember.HTMLBars</a></li>
                                <li><a href="../classes/Ember.inject.html">Ember.inject</a></li>
                                <li><a href="../classes/Ember.InjectedProperty.html">Ember.InjectedProperty</a></li>
                                <li><a href="../classes/Ember.Instrumentation.html">Ember.Instrumentation</a></li>
                                <li><a href="../classes/Ember.InstrumentationSupport.html">Ember.InstrumentationSupport</a></li>
                                <li><a href="../classes/Ember.LegacyViewSupport.html">Ember.LegacyViewSupport</a></li>
                                <li><a href="../classes/Ember.LinkComponent.html">Ember.LinkComponent</a></li>
                                <li><a href="../classes/Ember.Location.html">Ember.Location</a></li>
                                <li><a href="../classes/Ember.Logger.html">Ember.Logger</a></li>
                                <li><a href="../classes/Ember.Map.html">Ember.Map</a></li>
                                <li><a href="../classes/Ember.MapWithDefault.html">Ember.MapWithDefault</a></li>
                                <li><a href="../classes/Ember.Mixin.html">Ember.Mixin</a></li>
                                <li><a href="../classes/Ember.MutableArray.html">Ember.MutableArray</a></li>
                                <li><a href="../classes/Ember.MutableEnumerable.html">Ember.MutableEnumerable</a></li>
                                <li><a href="../classes/Ember.Namespace.html">Ember.Namespace</a></li>
                                <li><a href="../classes/Ember.NativeArray.html">Ember.NativeArray</a></li>
                                <li><a href="../classes/Ember.NoneLocation.html">Ember.NoneLocation</a></li>
                                <li><a href="../classes/Ember.Object.html">Ember.Object</a></li>
                                <li><a href="../classes/Ember.ObjectController.html">Ember.ObjectController</a></li>
                                <li><a href="../classes/Ember.ObjectProxy.html">Ember.ObjectProxy</a></li>
                                <li><a href="../classes/Ember.Observable.html">Ember.Observable</a></li>
                                <li><a href="../classes/Ember.OrderedSet.html">Ember.OrderedSet</a></li>
                                <li><a href="../classes/Ember.platform.html">Ember.platform</a></li>
                                <li><a href="../classes/Ember.PromiseProxyMixin.html">Ember.PromiseProxyMixin</a></li>
                                <li><a href="../classes/Ember.ProxyMixin.html">Ember.ProxyMixin</a></li>
                                <li><a href="../classes/Ember.ReduceComputedProperty.html">Ember.ReduceComputedProperty</a></li>
                                <li><a href="../classes/Ember.RenderBuffer.html">Ember.RenderBuffer</a></li>
                                <li><a href="../classes/Ember.Route.html">Ember.Route</a></li>
                                <li><a href="../classes/Ember.Router.html">Ember.Router</a></li>
                                <li><a href="../classes/Ember.run.html">Ember.run</a></li>
                                <li><a href="../classes/Ember.Select.html">Ember.Select</a></li>
                                <li><a href="../classes/Ember.Service.html">Ember.Service</a></li>
                                <li><a href="../classes/Ember.Set.html">Ember.Set</a></li>
                                <li><a href="../classes/Ember.SortableMixin.html">Ember.SortableMixin</a></li>
                                <li><a href="../classes/Ember.stream.Stream.html">Ember.stream.Stream</a></li>
                                <li><a href="../classes/Ember.streams.Dependency.html">Ember.streams.Dependency</a></li>
                                <li><a href="../classes/Ember.streams.Ember.stream.html">Ember.streams.Ember.stream</a></li>
                                <li><a href="../classes/Ember.streams.Subscriber.html">Ember.streams.Subscriber</a></li>
                                <li><a href="../classes/Ember.String.html">Ember.String</a></li>
                                <li><a href="../classes/Ember.SubArray.html">Ember.SubArray</a></li>
                                <li><a href="../classes/Ember.TargetActionSupport.html">Ember.TargetActionSupport</a></li>
                                <li><a href="../classes/Ember.TemplateRenderingSupport.html">Ember.TemplateRenderingSupport</a></li>
                                <li><a href="../classes/Ember.Templates.helpers.html">Ember.Templates.helpers</a></li>
                                <li><a href="../classes/Ember.Test.html">Ember.Test</a></li>
                                <li><a href="../classes/Ember.Test.Adapter.html">Ember.Test.Adapter</a></li>
                                <li><a href="../classes/Ember.Test.QUnitAdapter.html">Ember.Test.QUnitAdapter</a></li>
                                <li><a href="../classes/Ember.TextArea.html">Ember.TextArea</a></li>
                                <li><a href="../classes/Ember.TextField.html">Ember.TextField</a></li>
                                <li><a href="../classes/Ember.TextSupport.html">Ember.TextSupport</a></li>
                                <li><a href="../classes/Ember.TrackedArray.html">Ember.TrackedArray</a></li>
                                <li><a href="../classes/Ember.View.html">Ember.View</a></li>
                                <li><a href="../classes/Ember.ViewTargetActionSupport.html">Ember.ViewTargetActionSupport</a></li>
                                <li><a href="../classes/Ember.VisibilitySupport.html">Ember.VisibilitySupport</a></li>
                                <li><a href="../classes/Function.html">Function</a></li>
                                <li><a href="../classes/HandlebarsCompatibleHelper.html">HandlebarsCompatibleHelper</a></li>
                                <li><a href="../classes/Libraries.html">Libraries</a></li>
                                <li><a href="../classes/Registry.html">Registry</a></li>
                                <li><a href="../classes/RoutingService.html">RoutingService</a></li>
                                <li><a href="../classes/String.html">String</a></li>
                                <li><a href="../classes/TransformBindAttrToAttributes.html">TransformBindAttrToAttributes</a></li>
                                <li><a href="../classes/TransformEachInToBlockParams.html">TransformEachInToBlockParams</a></li>
                                <li><a href="../classes/TransformEachInToHash.html">TransformEachInToHash</a></li>
                                <li><a href="../classes/TransformInputOnToOnEvent.html">TransformInputOnToOnEvent</a></li>
                                <li><a href="../classes/TransformWithAsToHash.html">TransformWithAsToHash</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/ember.html">ember</a></li>
                                <li><a href="../modules/ember-application.html">ember-application</a></li>
                                <li><a href="../modules/ember-debug.html">ember-debug</a></li>
                                <li><a href="../modules/ember-extension-support.html">ember-extension-support</a></li>
                                <li><a href="../modules/ember-htmlbars.html">ember-htmlbars</a></li>
                                <li><a href="../modules/ember-metal.html">ember-metal</a></li>
                                <li><a href="../modules/ember-routing.html">ember-routing</a></li>
                                <li><a href="../modules/ember-routing-htmlbars.html">ember-routing-htmlbars</a></li>
                                <li><a href="../modules/ember-routing-views.html">ember-routing-views</a></li>
                                <li><a href="../modules/ember-runtime.html">ember-runtime</a></li>
                                <li><a href="../modules/ember-template-compiler.html">ember-template-compiler</a></li>
                                <li><a href="../modules/ember-templates.html">ember-templates</a></li>
                                <li><a href="../modules/ember-testing.html">ember-testing</a></li>
                                <li><a href="../modules/ember-views.html">ember-views</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: ember.js/packages/container/lib/container.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
import Ember from &#x27;ember-metal/core&#x27;; // Ember.assert
import emberKeys from &quot;ember-metal/keys&quot;;
import dictionary from &#x27;ember-metal/dictionary&#x27;;

// TODO - Temporary workaround for v0.4.0 of the ES6 transpiler, which lacks support for circular dependencies.
// See the below usage of requireModule. Instead, it should be possible to simply &#x60;import Registry from &#x27;./registry&#x27;;&#x60;
var Registry;

/**
 A container used to instantiate and cache objects.

 Every &#x60;Container&#x60; must be associated with a &#x60;Registry&#x60;, which is referenced
 to determine the factory and options that should be used to instantiate
 objects.

 The public API for &#x60;Container&#x60; is still in flux and should not be considered
 stable.

 @private
 @class Container
 */
function Container(registry, options) {
  this._registry = registry || (function() {
    Ember.deprecate(&quot;A container should only be created for an already instantiated registry. For backward compatibility, an isolated registry will be instantiated just for this container.&quot;);

    // TODO - See note above about transpiler import workaround.
    if (!Registry) { Registry = requireModule(&#x27;container/registry&#x27;)[&#x27;default&#x27;]; }

    return new Registry();
  }());

  this.cache        = dictionary(options &amp;&amp; options.cache ? options.cache : null);
  this.factoryCache = dictionary(options &amp;&amp; options.factoryCache ? options.factoryCache : null);
  this.validationCache = dictionary(options &amp;&amp; options.validationCache ? options.validationCache : null);
}

Container.prototype = {
  /**
   @private

   @property _registry
   @type Registry
   @since 1.11.0
   */
  _registry: null,

  /**
   @private

   @property cache
   @type InheritingDict
   */
  cache: null,

  /**
   @private
   @property factoryCache
   @type InheritingDict
   */
  factoryCache: null,

  /**
   @private
   @property validationCache
   @type InheritingDict
   */
  validationCache: null,

  /**
   Given a fullName return a corresponding instance.

   The default behaviour is for lookup to return a singleton instance.
   The singleton is scoped to the container, allowing multiple containers
   to all have their own locally scoped singletons.

   &#x60;&#x60;&#x60;javascript
   var registry = new Registry();
   var container = registry.container();

   registry.register(&#x27;api:twitter&#x27;, Twitter);

   var twitter = container.lookup(&#x27;api:twitter&#x27;);

   twitter instanceof Twitter; // =&gt; true

   // by default the container will return singletons
   var twitter2 = container.lookup(&#x27;api:twitter&#x27;);
   twitter2 instanceof Twitter; // =&gt; true

   twitter === twitter2; //=&gt; true
   &#x60;&#x60;&#x60;

   If singletons are not wanted an optional flag can be provided at lookup.

   &#x60;&#x60;&#x60;javascript
   var registry = new Registry();
   var container = registry.container();

   registry.register(&#x27;api:twitter&#x27;, Twitter);

   var twitter = container.lookup(&#x27;api:twitter&#x27;, { singleton: false });
   var twitter2 = container.lookup(&#x27;api:twitter&#x27;, { singleton: false });

   twitter === twitter2; //=&gt; false
   &#x60;&#x60;&#x60;

   @private
   @method lookup
   @param {String} fullName
   @param {Object} options
   @return {any}
   */
  lookup(fullName, options) {
    Ember.assert(&#x27;fullName must be a proper full name&#x27;, this._registry.validateFullName(fullName));
    return lookup(this, this._registry.normalize(fullName), options);
  },

  /**
   Given a fullName return the corresponding factory.

   @private
   @method lookupFactory
   @param {String} fullName
   @return {any}
   */
  lookupFactory(fullName) {
    Ember.assert(&#x27;fullName must be a proper full name&#x27;, this._registry.validateFullName(fullName));
    return factoryFor(this, this._registry.normalize(fullName));
  },

  /**
   A depth first traversal, destroying the container, its descendant containers and all
   their managed objects.

   @private
   @method destroy
   */
  destroy() {
    eachDestroyable(this, function(item) {
      if (item.destroy) {
        item.destroy();
      }
    });

    this.isDestroyed = true;
  },

  /**
   Clear either the entire cache or just the cache for a particular key.

   @private
   @method reset
   @param {String} fullName optional key to reset; if missing, resets everything
   */
  reset(fullName) {
    if (arguments.length &gt; 0) {
      resetMember(this, this._registry.normalize(fullName));
    } else {
      resetCache(this);
    }
  }
};

(function exposeRegistryMethods() {
  var methods = [
    &#x27;register&#x27;,
    &#x27;unregister&#x27;,
    &#x27;resolve&#x27;,
    &#x27;normalize&#x27;,
    &#x27;typeInjection&#x27;,
    &#x27;injection&#x27;,
    &#x27;factoryInjection&#x27;,
    &#x27;factoryTypeInjection&#x27;,
    &#x27;has&#x27;,
    &#x27;options&#x27;,
    &#x27;optionsForType&#x27;
  ];

  function exposeRegistryMethod(method) {
    Container.prototype[method] = function() {
      Ember.deprecate(method + &#x27; should be called on the registry instead of the container&#x27;);
      return this._registry[method].apply(this._registry, arguments);
    };
  }

  for (var i = 0, l = methods.length; i &lt; l; i++) {
    exposeRegistryMethod(methods[i]);
  }
})();

function lookup(container, fullName, options) {
  options = options || {};

  if (container.cache[fullName] &amp;&amp; options.singleton !== false) {
    return container.cache[fullName];
  }

  var value = instantiate(container, fullName);

  if (value === undefined) { return; }

  if (container._registry.getOption(fullName, &#x27;singleton&#x27;) !== false &amp;&amp; options.singleton !== false) {
    container.cache[fullName] = value;
  }

  return value;
}

function buildInjections(container) {
  var hash = {};

  if (arguments.length &gt; 1) {
    var injectionArgs = Array.prototype.slice.call(arguments, 1);
    var injections = [];
    var injection;

    for (var i = 0, l = injectionArgs.length; i &lt; l; i++) {
      if (injectionArgs[i]) {
        injections = injections.concat(injectionArgs[i]);
      }
    }

    container._registry.validateInjections(injections);

    for (i = 0, l = injections.length; i &lt; l; i++) {
      injection = injections[i];
      hash[injection.property] = lookup(container, injection.fullName);
    }
  }

  return hash;
}

function factoryFor(container, fullName) {
  var cache = container.factoryCache;
  if (cache[fullName]) {
    return cache[fullName];
  }
  var registry = container._registry;
  var factory = registry.resolve(fullName);
  if (factory === undefined) { return; }

  var type = fullName.split(&#x27;:&#x27;)[0];
  if (!factory || typeof factory.extend !== &#x27;function&#x27; || (!Ember.MODEL_FACTORY_INJECTIONS &amp;&amp; type === &#x27;model&#x27;)) {
    if (factory &amp;&amp; typeof factory._onLookup === &#x27;function&#x27;) {
      factory._onLookup(fullName);
    }

    // TODO: think about a &#x27;safe&#x27; merge style extension
    // for now just fallback to create time injection
    cache[fullName] = factory;
    return factory;

  } else {
    var injections = injectionsFor(container, fullName);
    var factoryInjections = factoryInjectionsFor(container, fullName);

    factoryInjections._toString = registry.makeToString(factory, fullName);

    var injectedFactory = factory.extend(injections);
    injectedFactory.reopenClass(factoryInjections);

    if (factory &amp;&amp; typeof factory._onLookup === &#x27;function&#x27;) {
      factory._onLookup(fullName);
    }

    cache[fullName] = injectedFactory;

    return injectedFactory;
  }
}

function injectionsFor(container, fullName) {
  var registry = container._registry;
  var splitName = fullName.split(&#x27;:&#x27;);
  var type = splitName[0];

  var injections = buildInjections(container,
                                   registry.getTypeInjections(type),
                                   registry.getInjections(fullName));
  injections._debugContainerKey = fullName;
  injections.container = container;

  return injections;
}

function factoryInjectionsFor(container, fullName) {
  var registry = container._registry;
  var splitName = fullName.split(&#x27;:&#x27;);
  var type = splitName[0];

  var factoryInjections = buildInjections(container,
                                          registry.getFactoryTypeInjections(type),
                                          registry.getFactoryInjections(fullName));
  factoryInjections._debugContainerKey = fullName;

  return factoryInjections;
}

function instantiate(container, fullName) {
  var factory = factoryFor(container, fullName);
  var lazyInjections, validationCache;

  if (container._registry.getOption(fullName, &#x27;instantiate&#x27;) === false) {
    return factory;
  }

  if (factory) {
    if (typeof factory.create !== &#x27;function&#x27;) {
      throw new Error(&#x27;Failed to create an instance of \&#x27;&#x27; + fullName + &#x27;\&#x27;. &#x27; +
      &#x27;Most likely an improperly defined class or an invalid module export.&#x27;);
    }

    validationCache = container.validationCache;

    // Ensure that all lazy injections are valid at instantiation time
    if (!validationCache[fullName] &amp;&amp; typeof factory._lazyInjections === &#x27;function&#x27;) {
      lazyInjections = factory._lazyInjections();
      lazyInjections = container._registry.normalizeInjectionsHash(lazyInjections);

      container._registry.validateInjections(lazyInjections);
    }

    validationCache[fullName] = true;

    if (typeof factory.extend === &#x27;function&#x27;) {
      // assume the factory was extendable and is already injected
      return factory.create();
    } else {
      // assume the factory was extendable
      // to create time injections
      // TODO: support new&#x27;ing for instantiation and merge injections for pure JS Functions
      return factory.create(injectionsFor(container, fullName));
    }
  }
}

function eachDestroyable(container, callback) {
  var cache = container.cache;
  var keys = emberKeys(cache);
  var key, value;

  for (var i = 0, l = keys.length; i &lt; l; i++) {
    key = keys[i];
    value = cache[key];

    if (container._registry.getOption(key, &#x27;instantiate&#x27;) !== false) {
      callback(value);
    }
  }
}

function resetCache(container) {
  eachDestroyable(container, function(value) {
    if (value.destroy) {
      value.destroy();
    }
  });

  container.cache.dict = dictionary(null);
}

function resetMember(container, fullName) {
  var member = container.cache[fullName];

  delete container.factoryCache[fullName];

  if (member) {
    delete container.cache[fullName];

    if (member.destroy) {
      member.destroy();
    }
  }
}

export default Container;

    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
